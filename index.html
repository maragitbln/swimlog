<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Seepferdchen Schwimm-Tagebuch üê†</title>

  <!-- Kid-friendly font -->
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

  <style>
    /* üåä Animated water background */
    @keyframes waterWave {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    body {
      font-family: 'Fredoka One', sans-serif;
      background: linear-gradient(135deg, #a8e6ff, #ffffff, #b2f7ef, #a8e6ff);
      background-size: 400% 400%;
      animation: waterWave 20s ease-in-out infinite;
      text-align: center;
      padding: 20px;
      overflow-x: hidden;
    }

    h1 {
      color: #0077b6;
      position: relative;
      user-select: none;
    }

    /* Hidden reset button - click the fish in the title */
    #resetZone {
      position: absolute;
      top: 0;
      right: 40%;
      cursor: pointer;
      font-size: 0.8em;
      opacity: 0.2;
    }
    #resetZone:hover { opacity: 0.8; }

    .day-nav {
      margin: 20px 0;
      font-size: 1.2em;
    }

    .category {
      margin: 10px auto;
      max-width: 320px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(224, 247, 250, 0.85);
      border-radius: 12px;
      padding: 8px 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .label {
      font-weight: bold;
      color: #005f73;
    }

    .faces button {
      font-size: 1.5em;
      border: none;
      background: none;
      cursor: pointer;
      transition: transform 0.1s;
      filter: grayscale(1);
      opacity: 0.5;
    }

    .faces button.selected {
      transform: scale(1.2);
      filter: none;
      opacity: 1;
    }

    #super {
      display: none;
      font-size: 2em;
      color: #ff007f;
      margin-top: 20px;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }

    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
    }

    img.badge {
      width: 100px;
      margin-top: 15px;
      transition: transform 0.3s;
    }

    img.badge.unlocked {
      transform: rotate(10deg) scale(1.1);
    }

    /* Weekly progress bar */
    .progress-container {
      width: 80%;
      max-width: 400px;
      height: 16px;
      background-color: #d0f0ff;
      border-radius: 10px;
      margin: 20px auto;
      overflow: hidden;
      box-shadow: inset 0 0 4px rgba(0,0,0,0.2);
    }

    .progress-bar {
      height: 100%;
      background-color: #00b4d8;
      width: 0%;
      transition: width 0.5s ease;
    }

    /* Swimming fish */
    .fish {
      position: absolute;
      width: 80px;
      opacity: 0.9;
      pointer-events: none;
    }

    @keyframes swimRight {
      0% { transform: translateX(-120px); }
      100% { transform: translateX(110vw); }
    }

    @keyframes swimLeft {
      0% { transform: translateX(110vw) scaleX(-1); }
      100% { transform: translateX(-120px) scaleX(-1); }
    }
  </style>
</head>

<body>
  <h1>Seepferdchen Schwimm-Tagebuch 
    <span id="resetZone">üê†</span>
  </h1>

  <div class="day-nav">
    <button id="prevDay">‚¨ÖÔ∏è</button>
    <span id="dateDisplay"></span>
    <button id="nextDay">‚û°Ô∏è</button>
  </div>

  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div id="categories"></div>
  <div id="super">üéâ Super! üéâ</div>
  <img id="badge" class="badge" src="seepferdchen.png" alt="Seepferdchen Badge" />

  <canvas id="confetti"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script>
    const categories = ["Beine", "Arme", "Tauchen", "Springen"];
    const faces = ["üòû", "üòê", "üòÄ"];
    const today = new Date();
    let currentDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());

    const categoriesDiv = document.getElementById("categories");
    const dateDisplay = document.getElementById("dateDisplay");
    const superText = document.getElementById("super");
    const badge = document.getElementById("badge");
    const progressBar = document.getElementById("progressBar");
    const confettiCanvas = document.getElementById("confetti");
    const confetti = window.confetti.create(confettiCanvas, { resize: true });

    const yaySound = new Audio('yay.mp3');
    const popSound = new Audio('pop.mp3');

    function formatDate(d) {
      return d.toISOString().split("T")[0];
    }

    function loadData() {
      return JSON.parse(localStorage.getItem("swimData") || "{}");
    }

    function saveData(data) {
      localStorage.setItem("swimData", JSON.stringify(data));
    }

    function mondayOf(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = (day === 0 ? -6 : 1) - day;
      d.setDate(d.getDate() + diff);
      return d;
    }

    function render() {
      const data = loadData();
      const key = formatDate(currentDate);
      const dayData = data[key] || {};
      dateDisplay.textContent = currentDate.toLocaleDateString("de-DE", { weekday: 'short', day: 'numeric', month: 'short' });

      categoriesDiv.innerHTML = "";
      categories.forEach(cat => {
        const div = document.createElement("div");
        div.className = "category";
        const label = document.createElement("div");
        label.className = "label";
        label.textContent = cat;
        const facesDiv = document.createElement("div");
        facesDiv.className = "faces";
        faces.forEach((f, i) => {
          const btn = document.createElement("button");
          btn.textContent = f;
          if (dayData[cat] === i) btn.classList.add("selected");
          btn.onclick = () => {
            dayData[cat] = i;
            data[key] = dayData;
            saveData(data);
            popSound.currentTime = 0;
            popSound.play();
            render();
          };
          facesDiv.appendChild(btn);
        });
        div.appendChild(label);
        div.appendChild(facesDiv);
        categoriesDiv.appendChild(div);
      });

      // Celebration if all happy
      const allHappy = categories.every(cat => dayData[cat] === 2);
      if (allHappy) {
        superText.style.display = "block";
        badge.classList.add("unlocked");
        confetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });
        yaySound.currentTime = 0;
        yaySound.play();
      } else {
        superText.style.display = "none";
        badge.classList.remove("unlocked");
      }

      // Weekly progress bar
      const monday = mondayOf(currentDate);
      let happyDays = 0;
      for (let i = 0; i < 7; i++) {
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);
        const k = formatDate(d);
        const dd = data[k];
        if (dd && categories.every(c => dd[c] === 2)) happyDays++;
      }
      progressBar.style.width = (happyDays / 7 * 100) + "%";
    }

    document.getElementById("prevDay").onclick = () => {
      currentDate.setDate(currentDate.getDate() - 1);
      render();
    };
    document.getElementById("nextDay").onclick = () => {
      currentDate.setDate(currentDate.getDate() + 1);
      render();
    };

    // Hidden reset
    document.getElementById("resetZone").onclick = () => {
      if (confirm("Wirklich alles l√∂schen?")) {
        localStorage.removeItem("swimData");
        render();
      }
    };

    // Fish animation
    const fishImages = ['fish1.png', 'fish2.png', 'fish3.png'];
    for (let i = 0; i < 6; i++) {
      const fish = document.createElement('img');
      const imgName = fishImages[Math.floor(Math.random() * fishImages.length)];
      fish.src = imgName;
      fish.className = 'fish';
      fish.style.top = Math.random() * 80 + '%';
      fish.style.animationDuration = (10 + Math.random() * 20) + 's';
      fish.style.animationDelay = (-Math.random() * 20) + 's';

      // fish1 & fish3 = face left ‚Üí swim right‚Üíleft
      if (imgName.includes('1') || imgName.includes('3')) {
        fish.style.left = '110vw';
        fish.style.animationName = 'swimLeft';
      } else {
        fish.style.animationName = 'swimRight';
      }

      document.body.appendChild(fish);
    }

    render();
  </script>
</body>
</html>
